<!DOCTYPE html>
<html>
<head>
  <title>Ana Sayfa</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fafafa; }
    .oturum-kapat {
      background-color: #f44336;
      color: white;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      float: right;
    }
    .video-liste {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }
    .video-kart {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 400px;
    }
    video { width: 100%; border-radius: 5px; }
    .video-baslik { font-weight: bold; margin-bottom: 10px; display: block; color: #008577; }
  </style>
</head>
<body>
  <button onclick="window.location.href='index.html'" class="oturum-kapat">OTURUMU KAPAT</button>
  
  <h1>Sosyal Medya Akışı</h1>
  
  <h2>Kanallar:</h2>
  <button onclick="window.location.href='CodeByGaurav.html'">CodeByGaurav</button>
  <button onclick="window.location.href='Şüheda Çongar.html'">Şüheda Çongar</button>
  
  <h3>AKSİYONLAR</h3>
  <button onclick="window.location.href='video oluştur.html'" style="background: #008577; color: white; padding: 10px; border: none; cursor: pointer;">+ Yeni Video Oluştur</button>
  
  <hr>
  <h4>Şu içerikler ilginizi çekebilir:</h4>

  <div id="videoAkisi" class="video-liste">
      <p>Videolar yükleniyor...</p>
  </div>

  <script>
    // Sayfa açıldığında shorts.json'u oku
    async function videolariYukle() {
        try {
            // Not: shorts.json dosyasının sunucu üzerinden çekilmesi gerekir
            const response = await fetch('http://localhost:3000/videolari-getir');
            const videolar = await response.json();
            
            const akis = document.getElementById('videoAkisi');
            akis.innerHTML = ''; // "Yükleniyor" yazısını sil

            if (videolar.length === 0) {
                akis.innerHTML = '<p>Henüz hiç video yüklenmemiş.</p>';
                return;
            }

            // Videoları sondan başa (en yeni en üstte) listele
            videolar.reverse().forEach(video => {
                const kart = document.createElement('div');
                kart.className = 'video-kart';
                
                // Sunucudaki dosya yolunu (videolar\...) tarayıcının anlayacağı URL'ye çeviriyoruz
                // localhost:3000 üzerinden erişmek için sunucu tarafında 'static' ayarı gerekir
                const videoUrl = `http://localhost:3000/${video.dosya_yolu.replace(/\\/g, '/')}`;

                kart.innerHTML = `
                    <span class="video-baslik">${video.video_ismi}</span>
                    <video controls>
                        <source src="${videoUrl}" type="video/mp4">
                        Tarayıcınız video oynatmayı desteklemiyor.
                    </video>
                    <div style="font-size: 12px; color: #777; margin-top: 5px;">
                        NBT: ${video.nbt_kodu} | Tarih: ${video.tarih}
                    </div>
                `;
                akis.appendChild(kart);
            });
        } catch (hata) {
            console.error("Hata:", hata);
            document.getElementById('videoAkisi').innerHTML = '<p>Videolar yüklenirken bir hata oluştu. Sunucu kapalı olabilir.</p>';
        }
    }

    // Fonksiyonu çalıştır
    videolariYukle();
  </script>
</body>
</html>
